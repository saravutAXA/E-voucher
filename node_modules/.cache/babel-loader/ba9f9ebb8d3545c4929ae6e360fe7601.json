{"ast":null,"code":"import _regeneratorRuntime from \"D:\\\\React_AXA\\\\test-theme\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\n\nvar _marked =\n/*#__PURE__*/\n_regeneratorRuntime.mark(login),\n    _marked2 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(logout),\n    _marked3 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(register),\n    _marked4 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(forgetPassword),\n    _marked5 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(watchLoginUser),\n    _marked6 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(watchLogoutUser),\n    _marked7 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(watchRegisterUser),\n    _marked8 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(watchForgetPassword),\n    _marked9 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(authSaga);\n\nimport { Cookies } from \"react-cookie\";\nimport { all, call, fork, put, takeEvery } from 'redux-saga/effects';\nimport { LOGIN_USER, LOGOUT_USER, REGISTER_USER, FORGET_PASSWORD, SCOPE, GRANT_TYPE, CLIENT_ID, CLIENT_SECRET } from '../../constants/actionTypes';\nimport { loginUserSuccess, loginUserFailed, registerUserSuccess, registerUserFailed, forgetPasswordSuccess, forgetPasswordFailed, forgetAccessToken } from './actions';\nimport axios from 'axios';\nvar gobleURL = 'http://10.16.201.17';\n/**\r\n * Fetch data from given url\r\n * @param {*} url \r\n * @param {*} options \r\n */\n\nvar fetchJSON = function fetchJSON(url) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return fetch(url, options).then(function (response) {\n    if (!response.status === 200) {\n      throw response.json();\n    }\n\n    return response.json();\n  }).then(function (json) {\n    return json;\n  }).catch(function (error) {\n    throw error;\n  });\n};\n/**\r\n * Sets the session\r\n * @param {*} user \r\n */\n\n\nvar setSession = function setSession(user) {\n  var cookies = new Cookies();\n  if (user) cookies.set(\"user\", JSON.stringify(user), {\n    path: \"/\"\n  });else cookies.remove(\"user\");\n};\n\nvar setSessionToken = function setSessionToken(token) {\n  var cookies = new Cookies(); // if (token)\n\n  cookies.set(\"token\", JSON.stringify(token), {\n    path: \"/\"\n  }); // else\n  //     cookies.remove(\"token\");\n};\n/**\r\n * Sets the session\r\n * @param {*} token \r\n */\n\n\nvar getToken = function getToken() {\n  // const options = {\n  //     body: JSON.stringify({ scope: SCOPE,\n  //         grant_type: GRANT_TYPE,\n  //         client_id: CLIENT_ID,\n  //         client_secret:CLIENT_SECRET}),\n  //     method: 'POST',\n  //     headers: { 'Content-Type': 'application/json' }\n  // };\n  var realFetch = window.fetch; // let cookies = new Cookies();\n  // wrap in timeout to simulate server api call\n  // axios.get('https://jsonplaceholder.typicode.com/users', {withCredentials: true})\n  // .then(function (response) {\n  //     console.log(response.data);\n  //     // let accesstoken = JSON.parse(response.data);\n  //     // cookies.set(\"token\", response.data, { path: \"/\" });\n  //     setSessionToken(response.data);\n  // })\n  // .catch(function (error) {\n  //     console.log(error);\n  // });\n\n  return new Promise(function (resolve, reject) {\n    // wrap in timeout to simulate server api call\n    setTimeout(function () {\n      // authenticate\n      var options = {\n        scope: 'promotion',\n        grant_type: 'client_credentials',\n        client_id: 'promotion.dev',\n        client_secret: 'dM7CBvnrgbMKQUPasgRZLTzsG61PMJT9LHQ5wZ4v'\n      };\n      axios.post('http://localhost:51323/api/Values', {\n        value: \"5\"\n      }).then(function (response) {\n        console.log(response.data); // let accesstoken = JSON.parse(response.data);\n        // cookies.set(\"token\", response.data, { path: \"/\" });\n\n        resolve(response.data);\n      }).catch(function (error) {\n        console.log(error);\n      }); // pass through any requests not handled above\n      // realFetch('http://10.16.201.17/identityserver/connect/token', options).then(response => resolve(response));\n    }, 100);\n  }); // axios.get('https://jsonplaceholder.typicode.com/users', {withCredentials: true});\n  // axios.post(gobleURL +\"\"+ url, {\n  //     scope: 'promotion',\n  //     grant_type: 'client_credentials',\n  //     client_id: 'promotion.dev',\n  //     client_secret: 'dM7CBvnrgbMKQUPasgRZLTzsG61PMJT9LHQ5wZ4v'\n  // })\n  // .then(function (response) {\n  //     console.log(response);\n  // })\n  // .catch(function (error) {\n  //     console.log(error);\n  // });\n  // return ;\n  // return fetch(gobleURL +\"\"+ url, options)\n  //     .then(response => {\n  //         if (!response.status === 200) {\n  //             throw response.json();\n  //         }\n  //         return response.json();\n  //     })\n  //     .then(json => {\n  //         return json;\n  //     })\n  //     .catch(error => { \n  //             throw error \n  //     });\n};\n/**\r\n * Login the user\r\n * @param {*} payload - username and password \r\n */\n\n\nfunction login(_ref) {\n  var _ref$payload, username, password, options, responseToken, response, message;\n\n  return _regeneratorRuntime.wrap(function login$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _ref$payload = _ref.payload, username = _ref$payload.username, password = _ref$payload.password;\n          options = {\n            body: JSON.stringify({\n              username: username,\n              password: password\n            }),\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            }\n          };\n          _context.prev = 2;\n          _context.next = 5;\n          return call(getToken, '/identityserver/connect/token');\n\n        case 5:\n          responseToken = _context.sent;\n          // const responseToken = yield call(forgetAccessToken, 'promotion','client_credentials','promotion.dev','dM7CBvnrgbMKQUPasgRZLTzsG61PMJT9LHQ5wZ4v');\n          setSessionToken(responseToken);\n          _context.next = 9;\n          return call(fetchJSON, '/users/authenticate', options);\n\n        case 9:\n          response = _context.sent;\n          setSession(response);\n          _context.next = 13;\n          return put(loginUserSuccess(response));\n\n        case 13:\n          _context.next = 28;\n          break;\n\n        case 15:\n          _context.prev = 15;\n          _context.t0 = _context[\"catch\"](2);\n          _context.t1 = _context.t0.status;\n          _context.next = _context.t1 === 500 ? 20 : _context.t1 === 401 ? 22 : 24;\n          break;\n\n        case 20:\n          message = 'Internal Server Error';\n          return _context.abrupt(\"break\", 25);\n\n        case 22:\n          message = 'Invalid credentials';\n          return _context.abrupt(\"break\", 25);\n\n        case 24:\n          message = _context.t0;\n\n        case 25:\n          _context.next = 27;\n          return put(loginUserFailed(message));\n\n        case 27:\n          setSession(null);\n\n        case 28:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[2, 15]]);\n}\n/**\r\n * Logout the user\r\n * @param {*} param0 \r\n */\n\n\nfunction logout(_ref2) {\n  var history;\n  return _regeneratorRuntime.wrap(function logout$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          history = _ref2.payload.history;\n          _context2.prev = 1;\n          setSession(null);\n          setSessionToken(null);\n          _context2.next = 6;\n          return call(function () {\n            history.push(\"/login\");\n          });\n\n        case 6:\n          _context2.next = 10;\n          break;\n\n        case 8:\n          _context2.prev = 8;\n          _context2.t0 = _context2[\"catch\"](1);\n\n        case 10:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[1, 8]]);\n}\n/**\r\n * Register the user\r\n */\n\n\nfunction register(_ref3) {\n  var _ref3$payload, fullname, email, password, options, response, message;\n\n  return _regeneratorRuntime.wrap(function register$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _ref3$payload = _ref3.payload, fullname = _ref3$payload.fullname, email = _ref3$payload.email, password = _ref3$payload.password;\n          options = {\n            body: JSON.stringify({\n              fullname: fullname,\n              email: email,\n              password: password\n            }),\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            }\n          };\n          _context3.prev = 2;\n          _context3.next = 5;\n          return call(fetchJSON, '/users/register', options);\n\n        case 5:\n          response = _context3.sent;\n          _context3.next = 8;\n          return put(registerUserSuccess(response));\n\n        case 8:\n          _context3.next = 22;\n          break;\n\n        case 10:\n          _context3.prev = 10;\n          _context3.t0 = _context3[\"catch\"](2);\n          _context3.t1 = _context3.t0.status;\n          _context3.next = _context3.t1 === 500 ? 15 : _context3.t1 === 401 ? 17 : 19;\n          break;\n\n        case 15:\n          message = 'Internal Server Error';\n          return _context3.abrupt(\"break\", 20);\n\n        case 17:\n          message = 'Invalid credentials';\n          return _context3.abrupt(\"break\", 20);\n\n        case 19:\n          message = _context3.t0;\n\n        case 20:\n          _context3.next = 22;\n          return put(registerUserFailed(message));\n\n        case 22:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[2, 10]]);\n}\n/**\r\n * forget password\r\n */\n\n\nfunction forgetPassword(_ref4) {\n  var username, options, response, message;\n  return _regeneratorRuntime.wrap(function forgetPassword$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          username = _ref4.payload.username;\n          options = {\n            body: JSON.stringify({\n              username: username\n            }),\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            }\n          };\n          _context4.prev = 2;\n          _context4.next = 5;\n          return call(fetchJSON, '/users/password-reset', options);\n\n        case 5:\n          response = _context4.sent;\n          _context4.next = 8;\n          return put(forgetPasswordSuccess(response.message));\n\n        case 8:\n          _context4.next = 22;\n          break;\n\n        case 10:\n          _context4.prev = 10;\n          _context4.t0 = _context4[\"catch\"](2);\n          _context4.t1 = _context4.t0.status;\n          _context4.next = _context4.t1 === 500 ? 15 : _context4.t1 === 401 ? 17 : 19;\n          break;\n\n        case 15:\n          message = 'Internal Server Error';\n          return _context4.abrupt(\"break\", 20);\n\n        case 17:\n          message = 'Invalid credentials';\n          return _context4.abrupt(\"break\", 20);\n\n        case 19:\n          message = _context4.t0;\n\n        case 20:\n          _context4.next = 22;\n          return put(forgetPasswordFailed(message));\n\n        case 22:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4, null, [[2, 10]]);\n}\n\nexport function watchLoginUser() {\n  return _regeneratorRuntime.wrap(function watchLoginUser$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return takeEvery(LOGIN_USER, login);\n\n        case 2:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5);\n}\nexport function watchLogoutUser() {\n  return _regeneratorRuntime.wrap(function watchLogoutUser$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return takeEvery(LOGOUT_USER, logout);\n\n        case 2:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6);\n}\nexport function watchRegisterUser() {\n  return _regeneratorRuntime.wrap(function watchRegisterUser$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return takeEvery(REGISTER_USER, register);\n\n        case 2:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7);\n}\nexport function watchForgetPassword() {\n  return _regeneratorRuntime.wrap(function watchForgetPassword$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.next = 2;\n          return takeEvery(FORGET_PASSWORD, forgetPassword);\n\n        case 2:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8);\n}\n\nfunction authSaga() {\n  return _regeneratorRuntime.wrap(function authSaga$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.next = 2;\n          return all([fork(watchLoginUser), fork(watchLogoutUser), fork(watchRegisterUser), fork(watchForgetPassword)]);\n\n        case 2:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked9);\n}\n\nexport default authSaga;","map":{"version":3,"sources":["D:\\React_AXA\\test-theme\\src\\redux\\auth\\saga.js"],"names":["login","logout","register","forgetPassword","watchLoginUser","watchLogoutUser","watchRegisterUser","watchForgetPassword","authSaga","Cookies","all","call","fork","put","takeEvery","LOGIN_USER","LOGOUT_USER","REGISTER_USER","FORGET_PASSWORD","SCOPE","GRANT_TYPE","CLIENT_ID","CLIENT_SECRET","loginUserSuccess","loginUserFailed","registerUserSuccess","registerUserFailed","forgetPasswordSuccess","forgetPasswordFailed","forgetAccessToken","axios","gobleURL","fetchJSON","url","options","fetch","then","response","status","json","catch","error","setSession","user","cookies","set","JSON","stringify","path","remove","setSessionToken","token","getToken","realFetch","window","Promise","resolve","reject","setTimeout","scope","grant_type","client_id","client_secret","post","value","console","log","data","payload","username","password","body","method","headers","responseToken","message","history","push","fullname","email"],"mappings":"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","sourcesContent":["// @flow\r\nimport { Cookies } from \"react-cookie\";\r\nimport { all, call, fork, put, takeEvery } from 'redux-saga/effects';\r\n\r\nimport {\r\n    LOGIN_USER,\r\n    LOGOUT_USER,\r\n    REGISTER_USER,\r\n    FORGET_PASSWORD,\r\n    SCOPE,\r\n    GRANT_TYPE,\r\n    CLIENT_ID,\r\n    CLIENT_SECRET\r\n} from '../../constants/actionTypes';\r\n\r\n\r\nimport {\r\n    loginUserSuccess,\r\n    loginUserFailed,\r\n    registerUserSuccess,\r\n    registerUserFailed,\r\n    forgetPasswordSuccess,\r\n    forgetPasswordFailed,\r\n    forgetAccessToken\r\n} from './actions';\r\nimport axios from 'axios';\r\n\r\nconst gobleURL = 'http://10.16.201.17';\r\n\r\n/**\r\n * Fetch data from given url\r\n * @param {*} url \r\n * @param {*} options \r\n */\r\nconst fetchJSON = (url, options = {}) => {\r\n    return fetch(url, options)\r\n        .then(response => {\r\n            if (!response.status === 200) {\r\n                throw response.json();\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(json => {\r\n            return json;\r\n        })\r\n        .catch(error => { \r\n                throw error \r\n        });\r\n}\r\n\r\n\r\n/**\r\n * Sets the session\r\n * @param {*} user \r\n */\r\nconst setSession = (user) => {\r\n    let cookies = new Cookies();\r\n    if (user)\r\n        cookies.set(\"user\", JSON.stringify(user), { path: \"/\" });\r\n    else\r\n        cookies.remove(\"user\");\r\n};\r\n\r\nconst setSessionToken = (token) => {\r\n    let cookies = new Cookies();\r\n    // if (token)\r\n        cookies.set(\"token\", JSON.stringify(token), { path: \"/\" });\r\n    // else\r\n    //     cookies.remove(\"token\");\r\n};\r\n\r\n/**\r\n * Sets the session\r\n * @param {*} token \r\n */ \r\nconst  getToken = () => {\r\n    // const options = {\r\n    //     body: JSON.stringify({ scope: SCOPE,\r\n    //         grant_type: GRANT_TYPE,\r\n    //         client_id: CLIENT_ID,\r\n    //         client_secret:CLIENT_SECRET}),\r\n    //     method: 'POST',\r\n    //     headers: { 'Content-Type': 'application/json' }\r\n    // };\r\n    let realFetch = window.fetch;\r\n    \r\n\r\n    // let cookies = new Cookies();\r\n\r\n    // wrap in timeout to simulate server api call\r\n    // axios.get('https://jsonplaceholder.typicode.com/users', {withCredentials: true})\r\n    // .then(function (response) {\r\n    //     console.log(response.data);\r\n    //     // let accesstoken = JSON.parse(response.data);\r\n    //     // cookies.set(\"token\", response.data, { path: \"/\" });\r\n    //     setSessionToken(response.data);\r\n    // })\r\n    // .catch(function (error) {\r\n    //     console.log(error);\r\n    // });\r\n\r\n    return new Promise((resolve, reject) => {\r\n        // wrap in timeout to simulate server api call\r\n        setTimeout(() => {            \r\n            // authenticate\r\n            const options = {\r\n                scope : 'promotion',\r\n                grant_type : 'client_credentials',\r\n                client_id : 'promotion.dev',\r\n                client_secret : 'dM7CBvnrgbMKQUPasgRZLTzsG61PMJT9LHQ5wZ4v'\r\n            };\r\n            axios.post('http://localhost:51323/api/Values',{value : \"5\"})\r\n            .then(function (response) {\r\n                console.log(response.data);\r\n                // let accesstoken = JSON.parse(response.data);\r\n                // cookies.set(\"token\", response.data, { path: \"/\" });\r\n                resolve(response.data);\r\n            })\r\n            .catch(function (error) {\r\n                console.log(error);\r\n            });\r\n\r\n            // pass through any requests not handled above\r\n            // realFetch('http://10.16.201.17/identityserver/connect/token', options).then(response => resolve(response));\r\n\r\n        }, 100);\r\n    });\r\n    \r\n    \r\n    \r\n    // axios.get('https://jsonplaceholder.typicode.com/users', {withCredentials: true});\r\n    \r\n\r\n\r\n    // axios.post(gobleURL +\"\"+ url, {\r\n    //     scope: 'promotion',\r\n    //     grant_type: 'client_credentials',\r\n    //     client_id: 'promotion.dev',\r\n    //     client_secret: 'dM7CBvnrgbMKQUPasgRZLTzsG61PMJT9LHQ5wZ4v'\r\n    // })\r\n    // .then(function (response) {\r\n    //     console.log(response);\r\n    // })\r\n    // .catch(function (error) {\r\n    //     console.log(error);\r\n    // });\r\n\r\n    // return ;\r\n    // return fetch(gobleURL +\"\"+ url, options)\r\n    //     .then(response => {\r\n    //         if (!response.status === 200) {\r\n    //             throw response.json();\r\n    //         }\r\n    //         return response.json();\r\n    //     })\r\n    //     .then(json => {\r\n    //         return json;\r\n    //     })\r\n    //     .catch(error => { \r\n    //             throw error \r\n    //     });\r\n};\r\n\r\n\r\n\r\n/**\r\n * Login the user\r\n * @param {*} payload - username and password \r\n */\r\nfunction* login({ payload: { username, password } }) {\r\n    const options = {\r\n        body: JSON.stringify({ username, password }),\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' }\r\n    };\r\n\r\n\r\n    try {\r\n        const responseToken = yield call(getToken, '/identityserver/connect/token');\r\n\r\n        // const responseToken = yield call(forgetAccessToken, 'promotion','client_credentials','promotion.dev','dM7CBvnrgbMKQUPasgRZLTzsG61PMJT9LHQ5wZ4v');\r\n        setSessionToken(responseToken);\r\n        const response = yield call(fetchJSON, '/users/authenticate', options);\r\n        setSession(response);\r\n        yield put(loginUserSuccess(response));\r\n    } catch (error) {\r\n        let message;\r\n        switch (error.status) {\r\n            case 500: message = 'Internal Server Error'; break;\r\n            case 401: message = 'Invalid credentials'; break;\r\n            default: message = error;\r\n        }\r\n        yield put(loginUserFailed(message));\r\n        setSession(null);\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Logout the user\r\n * @param {*} param0 \r\n */\r\nfunction* logout({ payload: { history } }) {\r\n    try {\r\n        setSession(null);\r\n        setSessionToken(null)\r\n        yield call(() => {\r\n            history.push(\"/login\");\r\n        });\r\n    } catch (error) { }\r\n}\r\n\r\n/**\r\n * Register the user\r\n */\r\nfunction* register({ payload: { fullname, email, password } }) {\r\n    const options = {\r\n        body: JSON.stringify({ fullname, email, password }),\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' }\r\n    };\r\n\r\n    try {\r\n        const response = yield call(fetchJSON, '/users/register', options);\r\n        yield put(registerUserSuccess(response));\r\n    } catch (error) {\r\n        let message;\r\n        switch (error.status) {\r\n            case 500: message = 'Internal Server Error'; break;\r\n            case 401: message = 'Invalid credentials'; break;\r\n            default: message = error;\r\n        }\r\n        yield put(registerUserFailed(message));\r\n    }\r\n}\r\n\r\n/**\r\n * forget password\r\n */\r\nfunction* forgetPassword({ payload: { username } }) {\r\n    const options = {\r\n        body: JSON.stringify({ username }),\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' }\r\n    };\r\n\r\n    try {\r\n        const response = yield call(fetchJSON, '/users/password-reset', options);\r\n        yield put(forgetPasswordSuccess(response.message));\r\n    } catch (error) {\r\n        let message;\r\n        switch (error.status) {\r\n            case 500: message = 'Internal Server Error'; break;\r\n            case 401: message = 'Invalid credentials'; break;\r\n            default: message = error;\r\n        }\r\n        yield put(forgetPasswordFailed(message));\r\n    }\r\n}\r\n\r\n\r\nexport function* watchLoginUser():any {\r\n    yield takeEvery(LOGIN_USER, login);\r\n}\r\n\r\nexport function* watchLogoutUser():any {\r\n    yield takeEvery(LOGOUT_USER, logout);\r\n}\r\n\r\nexport function* watchRegisterUser():any {\r\n    yield takeEvery(REGISTER_USER, register);\r\n}\r\n\r\nexport function* watchForgetPassword():any {\r\n    yield takeEvery(FORGET_PASSWORD, forgetPassword);\r\n}\r\n\r\nfunction* authSaga():any {\r\n    yield all([\r\n        fork(watchLoginUser),\r\n        fork(watchLogoutUser),\r\n        fork(watchRegisterUser),\r\n        fork(watchForgetPassword),\r\n    ]);\r\n}\r\n\r\nexport default authSaga;"]},"metadata":{},"sourceType":"module"}